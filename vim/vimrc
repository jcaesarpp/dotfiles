" - - - - - - - - - 8< - - - PLUGINS - - - 8< - - - - - - - - -

call plug#begin('~/.vim/plugged')
    Plug 'airblade/vim-gitgutter'
    Plug 'bronson/vim-toggle-wrap'
    Plug 'itspriddle/vim-shellcheck'
    Plug 'junegunn/fzf', { 'do': { -> fzf#install() } }
    Plug 'junegunn/fzf.vim'
    Plug 'preservim/nerdtree'
    Plug 'tpope/vim-fugitive'
    Plug 'tpope/vim-speeddating'
    Plug 'tpope/vim-surround'
    Plug 'tribela/vim-transparent'
    Plug 'vim-scripts/SearchComplete'
    Plug 'wuelnerdotexe/vim-enfocado'
call plug#end()

" - - - - - - - - - 8< - - - UI & GENERAL SETTINGS - - - 8< - - - - - - - - -

colorscheme enfocado
filetype plugin indent on
set background=dark
set clipboard=unnamedplus
set cursorline
set nu rnu
set t_Co=256
set timeoutlen=500
set ttimeoutlen=10
set updatetime=300

" Search behavior
set ignorecase smartcase incsearch hlsearch

" Tabulation & Indentation
set autoindent expandtab shiftwidth=4 smarttab softtabstop=4 tabstop=4

" - - - - - - - - - 8< - - - FILE & PERSISTENCE - - - 8< - - - - - - - - -

" Centralized swap files
let s:swapdir = expand('~/.vim/swp')
if !isdirectory(s:swapdir) | call mkdir(s:swapdir, 'p', 0700) | endif
set directory=$HOME/.vim/swp//

" Centralized undo history
let s:undodir = expand('~/.vim/undo')
if !isdirectory(s:undodir) | call mkdir(s:undodir, 'p', 0700) | endif
set undofile
set undodir=$HOME/.vim/undo//

" Restore cursor position
autocmd BufReadPost *
  \ if line("'\"") >= 1 && line("'\"") <= line("$") && &ft !~# 'commit'
  \ | exe "normal! g`\"" | endif

" Strip trailing whitespace on save
autocmd BufWritePre * :%s/\s\+$//e

" - - - - - - - - - 8< - - - PLUGIN CONFIG & MAPPINGS - - - 8< - - - - - - - - -

" FZF
let g:fzf_command_prefix = 'Fzf'
let g:fzf_vim = {}
let g:fzf_vim.preview_window = ['right,50%,<70(up,40%)']

" Search files in current directory
nnoremap <C-p> :FzfFiles<CR>
" Search open buffers
nnoremap <leader>b :FzfBuffers<CR>
" Search lines in open buffers (fuzzily)
nnoremap <leader>l :FzfLines<CR>
" Search tags (useful for jumping to headings)
nnoremap <leader>t :FzfBTags<CR>""" " FZF

" NERDTree
let g:NERDTreeQuitOnOpen = 1
nnoremap <C-t> :NERDTreeToggle<CR>
nnoremap <C-f> :NERDTreeFind<CR>

" GitGutter
let g:gitgutter_sign_added = '+'
let g:gitgutter_sign_modified = '>'
let g:gitgutter_sign_removed = '-'
nmap [h <Plug>(GitGutterPrevHunk)
nmap ]h <Plug>(GitGutterNextHunk)

" --- GIT INTEGRATION ---
" Quick commit for current file using its name
nnoremap <leader>ga :G commit -am "%:t"<CR>
" Open interactive Git status
nnoremap <leader>gs :G<CR>
" Quick push
nnoremap <leader>gp :G push<CR>

" Dynamic relative numbering
augroup numbertoggle
    autocmd!
    autocmd BufEnter,FocusGained,InsertLeave * set relativenumber
    autocmd BufLeave,FocusLost,InsertEnter   * set norelativenumber
augroup END

